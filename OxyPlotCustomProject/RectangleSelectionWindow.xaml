<Window x:Class="OxyPlotCustomProject.RectangleSelectionWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:oxy="http://oxyplot.org/wpf"
        xmlns:behaviors="http://schemas.microsoft.com/xaml/behaviors"
        xmlns:local="clr-namespace:OxyPlotCustomProject"
        Title="矩形範囲選択機能付き散布図" Height="600" Width="900"
        WindowStartupLocation="CenterScreen">
    
    <Window.Resources>
        <Style TargetType="Button">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="MinWidth" Value="100"/>
        </Style>
        
        <Style TargetType="TextBlock">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        
        <Style TargetType="CheckBox">
            <Setter Property="Margin" Value="5"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ツールバー -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Background="LightGray" Margin="5">
            <Button Content="サンプルデータ生成" Command="{Binding GenerateSampleDataCommand}"/>
            <Button Content="選択クリア" Command="{Binding ClearSelectionCommand}"/>
            <Button Content="選択機能切り替え" Command="{Binding ToggleSelectionCommand}"/>
            <Button Content="矩形クリア" Command="{Binding ClearRectanglesCommand}"/>
            <Button Content="矩形表示切り替え" Command="{Binding ToggleRectanglesCommand}"/>
            
            <Separator Margin="10,0"/>
            
            <CheckBox Content="選択機能有効" IsChecked="{Binding IsSelectionEnabled}"/>
            
            <Separator Margin="10,0"/>
            
            <TextBlock Text="{Binding StatusText}" FontWeight="Bold" Foreground="DarkBlue"/>
        </StackPanel>

        <!-- メインコンテンツ -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- プロットエリア -->
            <oxy:PlotView Grid.Column="0" Model="{Binding PlotModel}" Margin="5">
                <behaviors:Interaction.Behaviors>
                    <local:RectangleSelectionMouseBehavior EnableRectangleSelection="{Binding IsSelectionEnabled}"/>
                </behaviors:Interaction.Behaviors>
            </oxy:PlotView>

            <!-- 区切り線 -->
            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Center" VerticalAlignment="Stretch" Background="Gray"/>

            <!-- 選択されたポイントの詳細情報 -->
            <Grid Grid.Column="2" Margin="5">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="選択されたポイント" FontWeight="Bold" FontSize="14" HorizontalAlignment="Center"/>
                
                <StackPanel Grid.Row="1">
                    <TextBlock Text="{Binding SelectedPointCount, StringFormat='選択数: {0}個'}" FontWeight="Bold" Foreground="Red"/>
                    
                    <ListBox ItemsSource="{Binding SelectedPoints}" 
                             DisplayMemberPath="DisplayText"
                             MaxHeight="400"
                             ScrollViewer.HorizontalScrollBarVisibility="Auto"
                             ScrollViewer.VerticalScrollBarVisibility="Auto">
                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem">
                                <Setter Property="Padding" Value="2"/>
                                <Setter Property="Margin" Value="1"/>
                                <Setter Property="Background" Value="LightYellow"/>
                            </Style>
                        </ListBox.ItemContainerStyle>
                    </ListBox>
                </StackPanel>
            </Grid>
        </Grid>

        <!-- ステータスバー -->
        <StatusBar Grid.Row="2" Background="LightBlue">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusText}"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Center">
                <TextBlock Text="操作方法: Shift + マウスドラッグで矩形選択（1つの矩形のみ）" FontStyle="Italic"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock Text="{Binding SelectedPointCount, StringFormat='選択: {0}個'}"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
